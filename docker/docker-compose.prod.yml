services:
  postgres:
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 1G

  redis:
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 512M

  elasticsearch:
    restart: unless-stopped
    environment:
      - xpack.security.enabled=true
      - 'ES_JAVA_OPTS=-Xms1g -Xmx1g'
      - ELASTIC_PASSWORD=${ELASTIC_PASSWORD:?ELASTIC_PASSWORD must be set}
    healthcheck:
      test:
        [
          'CMD-SHELL',
          'curl -f -u elastic:${ELASTIC_PASSWORD} http://localhost:9200/_cluster/health || exit 1',
        ]
      interval: 30s
      timeout: 10s
      retries: 5
    deploy:
      resources:
        limits:
          memory: 2G
